<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Draw Steel Montage Challenge Tracker</title>
  <style>
    :root{
      --bg:#f4f6f9; --fg:#1f2937; --muted:#4b5563; --card:#fff; --border:#d1d5db;
      --accent:#2563eb; --success:#16a34a; --success-weak:rgba(22,163,74,.15);
      --partial:#2563eb; --partial-weak:rgba(37,99,235,.15);
      --failure:#dc2626; --failure-weak:rgba(220,38,38,.15);
      --btn-bg:#f9fafb; --btn-fg:#111827; --btn-bg-hover:#e5e7eb;
      --title:#111827; --title-accent:#7c3aed;
      --theme-cta-bg:#111827; --theme-cta-fg:#fff; --theme-cta-border:#000;
      --emphasis-border:#111; --skip-weak:rgba(17,17,17,.15);
    }
    body.dark{
      --bg:#0f172a; --fg:#e5e7eb; --muted:#cbd5e1; --card:#111827; --border:#374151;
      --btn-bg:#0b1220; --btn-fg:#e5e7eb; --btn-bg-hover:#1f2937; --title:#f9fafb;
      --title-accent:#a78bfa;
      --success-weak:rgba(22,163,74,.25);
      --partial-weak:rgba(37,99,235,.25);
      --failure-weak:rgba(220,38,38,.25);
      --theme-cta-bg:#f9fafb; --theme-cta-fg:#111827; --theme-cta-border:#fff;
      --emphasis-border:#e5e7eb; --skip-weak:rgba(229,231,235,.22);
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--fg);margin:0}

    header{position:sticky;top:0;background:var(--card);padding:1rem;display:flex;flex-direction:column;align-items:center;z-index:10;border-bottom:1px solid var(--border);box-shadow:0 2px 6px rgba(0,0,0,.05)}
    header h1{margin:0;font-size:1.6rem;color:var(--title)}
    header h1::after{content:"";display:block;width:90px;height:3px;margin:.35rem auto 0;background:linear-gradient(90deg,var(--title-accent),var(--partial));border-radius:999px}
    .rules{font-size:.95rem;margin-top:.25rem;color:var(--muted)}
    .tracker{margin-top:.5rem;display:flex;gap:1rem;font-size:1.05rem;flex-wrap:wrap;justify-content:center}
    .tracker span{background:var(--card);border:1px solid var(--border);padding:.35rem .6rem;border-radius:999px;box-shadow:0 1px 3px rgba(0,0,0,.08)}
    .config{margin-top:.6rem;display:flex;gap:.6rem 1rem;align-items:center;flex-wrap:wrap;justify-content:center}
    .config label{font-weight:600}
    select{background:var(--card);color:var(--fg);border:1px solid var(--border);padding:.4rem .6rem;border-radius:8px;box-shadow:0 1px 2px rgba(0,0,0,.05)}
    .toolbar{margin-top:.5rem;display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center}
    .toolbar-btn{background:var(--btn-bg);color:var(--btn-fg);border:1px solid var(--border);padding:.5rem .9rem;border-radius:10px;cursor:pointer;box-shadow:0 1px 2px rgba(0,0,0,.05);font-weight:600}
    .toolbar-btn:hover{background:var(--btn-bg-hover)}
    #themeToggleBtn{background:var(--theme-cta-bg);color:var(--theme-cta-fg);border:2px solid var(--theme-cta-border);box-shadow:0 4px 12px rgba(0,0,0,.15)}
    #themeToggleBtn:hover{filter:brightness(1.05)}
    .rounds{display:flex;gap:1rem;margin:1rem auto;padding:0 1rem;max-width:1100px}
    .round{flex:1}
    .round h2{text-align:center;margin:.25rem 0 .6rem;padding-bottom:.4rem;border-bottom:1px dashed var(--border);color:var(--muted)}
    .challenge{background:var(--card);margin:.6rem 0;padding:.7rem;border-radius:12px;border:1px solid var(--border);transition:box-shadow .2s,border-color .2s,background .2s;box-shadow:0 1px 4px rgba(0,0,0,.06)}

    .edit-wrap{display:flex;align-items:center;gap:.4rem}
    .edit-wrap .edit-icon{opacity:0;transition:opacity .15s,transform .15s;transform:translateX(-4px);font-size:.95rem;user-select:none}
    .edit-wrap:hover .edit-icon,.edit-wrap:focus-within .edit-icon{opacity:1;transform:translateX(0)}
    .challenge input.title{flex:1;width:100%;background:transparent;border:1px dashed transparent;color:var(--title);font-weight:700;font-size:1rem;padding:.25rem .35rem;border-radius:8px}
    .challenge input.title.masked{color:var(--muted);font-style:italic}
    .edit-wrap:hover input.title,.edit-wrap:focus-within input.title{border-color:#b6beca;background:rgba(0,0,0,.02)}
    body.dark .edit-wrap:hover input.title,body.dark .edit-wrap:focus-within input.title{border-color:#cbd5e1;background:rgba(255,255,255,.04)}

    .outcomes{display:flex;gap:.45rem;align-items:center;flex-wrap:wrap;margin:.35rem 0}
    .outcomes button{padding:.35rem .6rem;border:1px solid var(--border);border-radius:999px;cursor:pointer;opacity:.95;box-shadow:0 1px 2px rgba(0,0,0,.05);font-weight:600}
    .outcomes button:hover{opacity:1}
    .outcomes button.active{outline:2px solid currentColor;opacity:1}
    .success{background:#ecfdf5;color:var(--success)}
    .partial{background:#eef2ff;color:var(--partial)}
    .failure{background:#fef2f2;color:var(--failure)}
    body.dark .success{background:rgba(22,163,74,.15)}
    body.dark .partial{background:rgba(37,99,235,.15)}
    body.dark .failure{background:rgba(220,38,38,.15)}
    .outcomes .skip{background:#fff;color:#111}
    body.dark .outcomes .skip{background:#0b0f1a;color:#fff}

    .notes-wrap{display:flex;align-items:center;gap:.4rem}
    textarea.notes{width:100%;min-height:72px;resize:vertical;background:#fbfdff;color:var(--fg);border:1px dashed transparent;border-radius:8px;padding:.5rem;box-shadow:inset 0 1px 2px rgba(0,0,0,.05)}
    .notes-wrap:hover textarea.notes,.notes-wrap:focus-within textarea.notes{border-color:#b6beca;background:#fff}
    body.dark textarea.notes{background:#0b1220}
    body.dark .notes-wrap:hover textarea.notes,body.dark .notes-wrap:focus-within textarea.notes{border-color:#cbd5e1;background:#0f172a}

    footer{text-align:center;font-size:.85rem;font-style:italic;margin:1rem;color:var(--muted)}

    .challenge.success-state{border-color:var(--success);box-shadow:0 0 0 3px var(--success-weak) inset}
    .challenge.partial-state{border-color:var(--partial);box-shadow:0 0 0 3px var(--partial-weak) inset}
    .challenge.failure-state{border-color:var(--failure);box-shadow:0 0 0 3px var(--failure-weak) inset}
    .challenge.skip-state{border-color:var(--emphasis-border);box-shadow:0 0 0 3px var(--skip-weak) inset}

    .status-green{color:var(--success);font-weight:700}
    .status-blue{color:var(--partial);font-weight:700}
    .status-red{color:var(--failure);font-weight:700}
    .status-muted{color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <h1>Draw Steel Montage Challenge Tracker</h1>
    <div class="rules"><ul id="rulesList"></ul></div>
    <div class="tracker">
      <span id="successes">Successes: 0</span>
      <span id="failures">Failures: 0</span>
      <span id="currentOutcome"><b>Current outcome:</b> <span id="outcomeText" class="status-muted">—</span></span>
    </div>
    <div class="config">
      <label>Players:</label>
      <select id="playerCount">
        <option value="1">1</option><option value="2">2</option><option value="3">3</option>
        <option value="4" selected>4</option><option value="5">5</option><option value="6">6</option>
        <option value="7">7</option><option value="8">8</option>
      </select>
      <label>Difficulty:</label>
      <select id="difficulty">
        <option value="easy">Easy</option>
        <option value="moderate" selected>Moderate</option>
        <option value="hard">Hard</option>
      </select>
      <span id="limits"></span>
    </div>
    <div class="toolbar">
      <button id="revealAllBtn" class="toolbar-btn">Reveal All</button>
      <button id="hideAllBtn" class="toolbar-btn">Hide All</button>
      <button id="resetAllBtn" class="toolbar-btn">Reset All</button>
      <button id="themeToggleBtn" class="toolbar-btn" title="Toggle Light/Dark">Dark Mode</button>
    </div>
  </header>

  <div class="rounds">
    <div class="round" id="round1"><h2>Round 1</h2></div>
    <div class="round" id="round2"><h2>Round 2</h2></div>
  </div>

  <footer>vibe coded by docMurk and ChatGPT (ver 0.21).</footer>

  <script>
  (function(){
    const successEl = document.getElementById("successes");
    const failureEl = document.getElementById("failures");
    const outcomeText = document.getElementById("outcomeText");
    const difficultyEl = document.getElementById("difficulty");
    const limitsEl = document.getElementById("limits");
    const playerSelect = document.getElementById("playerCount");
    const revealAllBtn = document.getElementById("revealAllBtn");
    const hideAllBtn = document.getElementById("hideAllBtn");
    const resetAllBtn = document.getElementById("resetAllBtn");
    const themeToggleBtn = document.getElementById("themeToggleBtn");
    const rulesList = document.getElementById("rulesList");

    let successes = 0;
    let failures = 0;
    let numPlayers = parseInt(playerSelect.value, 10) || 4;
    let successLimit = 0, failureLimit = 0;

    const baseLimits = {
      easy:{success:5,failure:5},
      moderate:{success:6,failure:4},
      hard:{success:7,failure:3}
    };

    const savedTheme = localStorage.getItem('montage_theme');
    if (savedTheme === 'dark') document.body.classList.add('dark');
    updateThemeButtonLabel();

    function updateThemeButtonLabel(){
      themeToggleBtn.textContent = document.body.classList.contains('dark') ? 'Light Mode' : 'Dark Mode';
    }

    function updateLimits() {
      const diff = difficultyEl.value;
      let base = baseLimits[diff] || baseLimits.moderate;
      let success = base.success, failure = base.failure;

      if (numPlayers < 5) { const adj = 5 - numPlayers; success = Math.max(2, success - adj); failure = Math.max(2, failure - adj); }
      else if (numPlayers > 5) { const adj = numPlayers - 5; success += adj; failure += adj; }

      successLimit = success; failureLimit = failure;
      limitsEl.textContent = `(Success Limit: ${success}, Failure Limit: ${failure})`;

      if (rulesList) {
        rulesList.innerHTML = `
          <li><b>Total Success:</b> Reach or exceed the <b>${success}</b> success limit before hitting the <b>${failure}</b> failure limit.</li>
          <li><b>Partial Success:</b> End Round 2 with at least two more successes than failures, without hitting either limit.</li>
          <li><b>Total Failure:</b> Reach the <b>${failure}</b> failure limit, or at the end of Round 2 if successes are not at least two greater than failures.</li>
        `;
      }
      updateOutcome();
    }

    function resetCountsOnly() {
      successes = 0; failures = 0;
      successEl.textContent = 'Successes: ' + successes;
      failureEl.textContent = 'Failures: ' + failures;
      updateOutcome();
    }

    function updateCounts() {
      successEl.textContent = 'Successes: ' + successes;
      failureEl.textContent = 'Failures: ' + failures;
      updateOutcome();
    }

    function updateOutcome() {
      outcomeText.className = '';
      // Terminal states first
      if (failures >= failureLimit && failureLimit > 0) { outcomeText.textContent = 'Failure'; outcomeText.classList.add('status-red'); return; }
      if (successes >= successLimit && successLimit > 0) { outcomeText.textContent = 'Total Success'; outcomeText.classList.add('status-green'); return; }

      // Remaining undecided challenges (state === 'none'); Skips are considered decided
      const remaining = document.querySelectorAll('.challenge[data-state="none"]').length;

      // If all decided (including Skips), apply end-of-round rule
      if (remaining === 0) {
        if ((successes - failures) >= 2) { outcomeText.textContent = 'Partial Success'; outcomeText.classList.add('status-blue'); }
        else { outcomeText.textContent = 'Failure'; outcomeText.classList.add('status-red'); }
        return;
      }

      // Mid-way guidance
      if ((successes - failures) >= 2) { outcomeText.textContent = 'Partial Success'; outcomeText.classList.add('status-blue'); }
      else { outcomeText.textContent = '—'; outcomeText.classList.add('status-muted'); }
    }

    function createChallenge(num) {
      const challenge = document.createElement('div');
      challenge.className = 'challenge';
      challenge.dataset.state = 'none';
      challenge.dataset.index = String(num);

      const titleWrap = document.createElement('div');
      titleWrap.className = 'edit-wrap';
      const title = document.createElement('input');
      title.type = 'text';
      title.className = 'title';
      title.value = 'Challenge ' + num;
      const titleIcon = document.createElement('span');
      titleIcon.className = 'edit-icon';
      titleIcon.textContent = '✎';
      titleWrap.append(title, titleIcon);

      const toggleBtn = document.createElement('button');
      toggleBtn.textContent = 'Hide';
      toggleBtn.className = 'toolbar-btn';

      const content = document.createElement('div');
      content.className = 'content';
      content.style.display = 'block';

      function maskTitle(){ if (!challenge.dataset.originalTitle) challenge.dataset.originalTitle = title.value; title.value = 'Challenge ' + challenge.dataset.index; title.readOnly = true; title.classList.add('masked'); }
      function unmaskTitle(){ if (challenge.dataset.originalTitle) title.value = challenge.dataset.originalTitle; title.readOnly = false; title.classList.remove('masked'); }

      toggleBtn.onclick = () => {
        const isHidden = content.style.display === 'none';
        if (isHidden) { content.style.display = 'block'; unmaskTitle(); toggleBtn.textContent = 'Hide'; }
        else { content.style.display = 'none'; maskTitle(); toggleBtn.textContent = 'Reveal'; }
      };

      const outcomes = document.createElement('div'); outcomes.className = 'outcomes';
      const btnSuccess = document.createElement('button'); btnSuccess.className = 'success'; btnSuccess.textContent = 'Total Success';
      const btnPartial = document.createElement('button'); btnPartial.className = 'partial'; btnPartial.textContent = 'Partial Success';
      const btnFailure = document.createElement('button'); btnFailure.className = 'failure'; btnFailure.textContent = 'Failure';
      const btnSkip    = document.createElement('button'); btnSkip.className = 'skip';    btnSkip.textContent = 'Skip';

      function setChallengeState(next){
        const prev = challenge.dataset.state || 'none';
        if (prev === next) next = 'none';

        if (prev === 'success' || prev === 'partial') successes = Math.max(0, successes - 1);
        if (prev === 'failure') failures = Math.max(0, failures - 1);
        if (next === 'success' || next === 'partial') successes += 1;
        if (next === 'failure') failures += 1;

        challenge.dataset.state = next;
        challenge.classList.remove('success-state','partial-state','failure-state','skip-state');
        [btnSuccess, btnPartial, btnFailure, btnSkip].forEach(b=>b.classList.remove('active'));

        if (next === 'success') { challenge.classList.add('success-state'); btnSuccess.classList.add('active'); }
        if (next === 'partial') { challenge.classList.add('partial-state'); btnPartial.classList.add('active'); }
        if (next === 'failure') { challenge.classList.add('failure-state'); btnFailure.classList.add('active'); }
        if (next === 'skip')    { challenge.classList.add('skip-state');    btnSkip.classList.add('active'); }

        updateCounts();
      }

      btnSuccess.onclick = () => setChallengeState('success');
      btnPartial.onclick = () => setChallengeState('partial');
      btnFailure.onclick = () => setChallengeState('failure');
      btnSkip.onclick    = () => setChallengeState('skip');

      outcomes.append(btnSuccess, btnPartial, btnFailure, btnSkip);

      const notesWrap = document.createElement('div'); notesWrap.className = 'notes-wrap edit-wrap';
      const notes = document.createElement('textarea'); notes.className = 'notes'; notes.placeholder = 'Enter consequence here...';
      const notesIcon = document.createElement('span'); notesIcon.className = 'edit-icon'; notesIcon.textContent = '✎';
      notesWrap.append(notes, notesIcon);

      content.append(outcomes, notesWrap);
      challenge.append(titleWrap, toggleBtn, content);
      return challenge;
    }

    function renderChallenges(){
      const r1 = document.getElementById('round1');
      const r2 = document.getElementById('round2');
      r1.innerHTML = '<h2>Round 1</h2>';
      r2.innerHTML = '<h2>Round 2</h2>';
      for (let i=1;i<=numPlayers;i++) r1.appendChild(createChallenge(i));
      for (let i=1;i<=numPlayers;i++) r2.appendChild(createChallenge(numPlayers+i));
    }

    difficultyEl.onchange = () => { updateLimits(); };
    playerSelect.onchange = () => { numPlayers = parseInt(playerSelect.value,10); resetAllSelections(); renderChallenges(); updateLimits(); };

    revealAllBtn.onclick = () => {
      document.querySelectorAll('.challenge').forEach(ch => {
        const content = ch.querySelector('.content');
        const toggleBtn = ch.querySelector('button.toolbar-btn');
        const title = ch.querySelector('input.title');
        if (content) content.style.display = 'block';
        if (title) { if (ch.dataset.originalTitle) title.value = ch.dataset.originalTitle; title.readOnly = false; title.classList.remove('masked'); }
        if (toggleBtn) toggleBtn.textContent = 'Hide';
      });
    };

    hideAllBtn.onclick = () => {
      document.querySelectorAll('.challenge').forEach(ch => {
        const content = ch.querySelector('.content');
        const toggleBtn = ch.querySelector('button.toolbar-btn');
        const title = ch.querySelector('input.title');
        if (content) content.style.display = 'none';
        if (title) { if (!ch.dataset.originalTitle) ch.dataset.originalTitle = title.value; title.value = 'Challenge ' + (ch.dataset.index || '?'); title.readOnly = true; title.classList.add('masked'); }
        if (toggleBtn) toggleBtn.textContent = 'Reveal';
      });
    };

    function resetAllSelections(){
      successes = 0; failures = 0;
      document.querySelectorAll('.challenge').forEach(ch => {
        ch.dataset.state = 'none';
        ch.classList.remove('success-state','partial-state','failure-state','skip-state');
        ch.querySelectorAll('.outcomes button').forEach(b=>b.classList.remove('active'));
      });
      resetCountsOnly();
    }

    resetAllBtn.onclick = () => { resetAllSelections(); };

    themeToggleBtn.onclick = () => {
      document.body.classList.toggle('dark');
      localStorage.setItem('montage_theme', document.body.classList.contains('dark') ? 'dark' : 'light');
      updateThemeButtonLabel();
    };

    renderChallenges();
    updateLimits();
    resetCountsOnly();
  })();
  </script>
</body>
</html>
